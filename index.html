<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Employee Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 flex items-center justify-center min-h-screen">

<div class="bg-white p-6 rounded-2xl shadow max-w-md w-full">
<!-- LOGO -->
<div class="flex justify-center mb-4">
  <img src="https://lh3.googleusercontent.com/d/1SeUounYKA5sEcvXJs6JHC1eK1881pOHg" alt="">
</div>

<h1 class="text-lg font-bold mb-4 text-center text-slate-700">
  Karmchari Khoj Portal
</h1>

<!-- DISTRICT -->
<select id="district" class="border p-2 rounded w-full mb-3">
  <option value="">Select District</option>
 <option value="Agra">Agra</option>
<option value="Aligarh">Aligarh</option>
<option value="Ambedkar Nagar">Ambedkar Nagar</option>
<option value="Amethi">Amethi</option>
<option value="Amroha">Amroha</option>
<option value="Auraiya">Auraiya</option>
<option value="Ayodhya">Ayodhya</option>
<option value="Azamgarh">Azamgarh</option>
<option value="Baghpat">Baghpat</option>
<option value="Bahraich">Bahraich</option>
<option value="Ballia">Ballia</option>
<option value="Balrampur">Balrampur</option>
<option value="Banda">Banda</option>
<option value="Barabanki">Barabanki</option>
<option value="Bareilly">Bareilly</option>
<option value="Basti">Basti</option>
<option value="Bhadohi">Bhadohi</option>
<option value="Bijnor">Bijnor</option>
<option value="Budaun">Budaun</option>
<option value="Bulandshahr">Bulandshahr</option>
<option value="Chandauli">Chandauli</option>
<option value="Chitrakoot">Chitrakoot</option>
<option value="Deoria">Deoria</option>
<option value="Etah">Etah</option>
<option value="Etawah">Etawah</option>
<option value="Farrukhabad">Farrukhabad</option>
<option value="Fatehpur">Fatehpur</option>
<option value="Firozabad">Firozabad</option>
<option value="Gautam Buddha Nagar">Gautam Buddha Nagar</option>
<option value="Ghaziabad">Ghaziabad</option>
<option value="Ghazipur">Ghazipur</option>
<option value="Gonda">Gonda</option>
<option value="Gorakhpur">Gorakhpur</option>
<option value="Hamirpur">Hamirpur</option>
<option value="Hapur">Hapur</option>
<option value="Hardoi">Hardoi</option>
<option value="Hathras">Hathras</option>
<option value="Jalaun">Jalaun</option>
<option value="Jaunpur">Jaunpur</option>
<option value="Jhansi">Jhansi</option>
<option value="Kannauj">Kannauj</option>
<option value="Kanpur Dehat">Kanpur Dehat</option>
<option value="Kanpur Nagar">Kanpur Nagar</option>
<option value="Kasganj">Kasganj</option>
<option value="Kaushambi">Kaushambi</option>
<option value="Kushinagar">Kushinagar</option>
<option value="Lakhimpur Kheri">Lakhimpur Kheri</option>
<option value="Lalitpur">Lalitpur</option>
<option value="Lucknow">Lucknow</option>
<option value="Maharajganj">Maharajganj</option>
<option value="Mahoba">Mahoba</option>
<option value="Mainpuri">Mainpuri</option>
<option value="Mathura">Mathura</option>
<option value="Mau">Mau</option>
<option value="Meerut">Meerut</option>
<option value="Mirzapur">Mirzapur</option>
<option value="Moradabad">Moradabad</option>
<option value="Muzaffarnagar">Muzaffarnagar</option>
<option value="Pilibhit">Pilibhit</option>
<option value="Pratapgarh">Pratapgarh</option>
<option value="Prayagraj">Prayagraj</option>
<option value="Rae Bareli">Rae Bareli</option>
<option value="Rampur">Rampur</option>
<option value="Saharanpur">Saharanpur</option>
<option value="Sambhal">Sambhal</option>
<option value="Sant Kabir Nagar">Sant Kabir Nagar</option>
<option value="Shahjahanpur">Shahjahanpur</option>
<option value="Shamli">Shamli</option>
<option value="Shravasti">Shravasti</option>
<option value="Siddharthnagar">Siddharthnagar</option>
<option value="Sitapur">Sitapur</option>
<option value="Sonbhadra">Sonbhadra</option>
<option value="Sultanpur">Sultanpur</option>
<option value="Unnao">Unnao</option>
<option value="Varanasi">Varanasi</option>
</select>

<!-- OFFICE -->
<select id="office" class="border p-2 rounded w-full mb-3">
  <option value="">Select Office</option>
</select>

<!-- EMPLOYEE -->
<select id="employee" class="border p-2 rounded w-full mb-3">
  <option value="">Select Employee</option>
</select>

<!-- PASSWORD -->
<input id="password" type="password"
  placeholder="Enter Password"
  class="border p-2 rounded w-full mb-3">

<button id="loginBtn"
  class="bg-indigo-600 hover:bg-indigo-700 text-white w-full p-3 rounded-xl font-bold">
Login
</button>

<p id="msg" class="text-red-600 text-sm mt-3"></p>

<!-- üîê ADMIN LOGIN BUTTON -->
<div class="mt-6 text-center border-t pt-4">
  <a href="admin-login.html"
     class="inline-block text-indigo-600 font-bold hover:underline">
     üîê Admin Login
  </a>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBDE0Oy6bSo05jl48kugFnrtHAPZt-eanA",
  authDomain: "antrik-lekha.firebaseapp.com",
  projectId: "antrik-lekha",
  appId: "1:82198306544:web:bfb58e6c8d03f7d664ac35"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ELEMENTS */
const district = document.getElementById("district");
const office = document.getElementById("office");
const employee = document.getElementById("employee");
const passwordInput = document.getElementById("password");
const msg = document.getElementById("msg");

let selectedEmployee = null;

/* DISTRICT ‚Üí OFFICE */
district.onchange = async () => {
  office.innerHTML = `<option value="">Select Office</option>`;
  employee.innerHTML = `<option value="">Select Employee</option>`;
  msg.textContent = "";

  if (!district.value) return;

  const q = query(
    collection(db, "employees"),
    where("district", "==", district.value)
  );

  const snap = await getDocs(q);
  const offices = [...new Set(
    snap.docs.map(d => d.data().office).filter(Boolean)
  )];

  offices.forEach(o => {
    const opt = document.createElement("option");
    opt.value = o;
    opt.textContent = o;
    office.appendChild(opt);
  });
};

/* OFFICE ‚Üí EMPLOYEE */
office.onchange = async () => {
  employee.innerHTML = `<option value="">Select Employee</option>`;
  msg.textContent = "";

  if (!office.value) return;

  const q = query(
    collection(db, "employees"),
    where("district", "==", district.value),
    where("office", "==", office.value)
  );

  const snap = await getDocs(q);
  snap.forEach(d => {
    const opt = document.createElement("option");
    opt.value = d.id;
    opt.textContent = d.data().name;
    employee.appendChild(opt);
  });
};

/* LOGIN */
loginBtn.onclick = async () => {
  msg.textContent = "";

  if (!employee.value || !passwordInput.value) {
    msg.textContent = "Please select employee and enter password";
    return;
  }

  const snap = await getDocs(collection(db, "employees"));
  snap.forEach(d => {
    if (d.id === employee.value) selectedEmployee = d.data();
  });

  if (!selectedEmployee) {
    msg.textContent = "Employee not found";
    return;
  }

  const firstName = selectedEmployee.name.split(" ")[0];
  const last5 = selectedEmployee.phone.slice(-5);
  const expectedPassword = firstName + last5;

  if (
    passwordInput.value.trim().toLowerCase() ===
    expectedPassword.toLowerCase()
  ) {
    sessionStorage.setItem("empAuth", "true");
    sessionStorage.setItem("empName", selectedEmployee.name);
    location.href = "public-dashboard.html";
  } else {
    msg.textContent = "Invalid password";
  }
};
</script>

</body>
</html>


