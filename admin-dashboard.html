<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body class="bg-slate-100">

<header class="bg-indigo-700 text-white p-4 flex justify-between items-center">
  <h1 class="text-xl font-bold">Admin Dashboard</h1>
  <button id="logoutBtn"
    class="bg-red-500 px-4 py-2 rounded-xl font-bold">
    Logout
  </button>
</header>

<main class="max-w-7xl mx-auto p-6">

<!-- FORM -->
<div class="bg-white p-6 rounded-2xl shadow mb-8">
<h2 class="font-bold text-lg mb-4">Add / Edit Employee</h2>

<form id="empForm" class="grid md:grid-cols-3 gap-4">
  <input type="hidden" id="docId">

  <input id="nameInput" class="border p-2 rounded-xl" placeholder="Name" required>
  <input id="phoneInput" class="border p-2 rounded-xl" placeholder="Phone" required>

  <select id="districtInput" class="border p-2 rounded-xl" required>
    <option value="">Select District</option>
    <option>Lucknow</option>
    <option>Kanpur Nagar</option>
    <option>Varanasi</option>
    <option>Prayagraj</option>
    <option>Agra</option>
  </select>

  <input id="officeInput" class="border p-2 rounded-xl" placeholder="Office">

  <select id="postInput" class="border p-2 rounded-xl" required>
    <option value="">Select Post</option>
    <option>Assistant Accountant</option>
    <option>Accountant</option>
    <option>Assistant Account Officer</option>
  </select>

  <button class="bg-green-600 text-white p-3 rounded-xl font-bold col-span-3">
    Save
  </button>
</form>
</div>

<!-- EXCEL -->
<div class="bg-white p-6 rounded-2xl shadow mb-8">
<h2 class="font-bold text-lg mb-4">Upload Excel</h2>
<input type="file" id="excelFile" accept=".xlsx">
<button id="uploadExcelBtn"
  class="bg-indigo-600 text-white px-4 py-2 rounded-xl ml-3">
Upload
</button>
</div>

<!-- TABLE -->
<div class="bg-white p-6 rounded-2xl shadow">
<table class="w-full border text-sm">
<thead class="bg-slate-100">
<tr>
<th class="border p-2">Name</th>
<th class="border p-2">Phone</th>
<th class="border p-2">District</th>
<th class="border p-2">Office</th>
<th class="border p-2">Post</th>
<th class="border p-2">Action</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, collection, getDocs,
  addDoc, updateDoc, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBDE0Oy6bSo05jl48kugFnrtHAPZt-eanA",
  authDomain: "antrik-lekha.firebaseapp.com",
  projectId: "antrik-lekha",
  appId: "1:82198306544:web:bfb58e6c8d03f7d664ac35"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ELEMENTS */
const empForm = document.getElementById("empForm");
const docId = document.getElementById("docId");
const nameInput = document.getElementById("nameInput");
const phoneInput = document.getElementById("phoneInput");
const districtInput = document.getElementById("districtInput");
const officeInput = document.getElementById("officeInput");
const postInput = document.getElementById("postInput");
const list = document.getElementById("list");

/* AUTH */
onAuthStateChanged(auth, user=>{
  if(!user) location.href="admin-login.html";
});
logoutBtn.onclick = ()=>signOut(auth);

/* LOAD */
async function loadData(){
  list.innerHTML="";
  const snap = await getDocs(collection(db,"employees"));

  snap.forEach(d=>{
    const e = d.data();
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td class="border p-2">${e.name}</td>
      <td class="border p-2">${e.phone}</td>
      <td class="border p-2">${e.district}</td>
      <td class="border p-2">${e.office||""}</td>
      <td class="border p-2">${e.post}</td>
      <td class="border p-2 space-x-2">
        <button class="edit bg-yellow-400 px-3 py-1 rounded">Edit</button>
        <button class="del bg-red-500 text-white px-3 py-1 rounded">Delete</button>
      </td>
    `;

    tr.querySelector(".edit").addEventListener("click", ()=>{
      docId.value = d.id;
      nameInput.value = e.name;
      phoneInput.value = e.phone;
      districtInput.value = e.district;
      officeInput.value = e.office||"";
      postInput.value = e.post;
      window.scrollTo({top:0,behavior:"smooth"});
    });

    tr.querySelector(".del").addEventListener("click", async()=>{
      if(confirm("Delete record?")){
        await deleteDoc(doc(db,"employees",d.id));
        loadData();
      }
    });

    list.appendChild(tr);
  });
}
loadData();

/* SAVE */
empForm.addEventListener("submit", async e=>{
  e.preventDefault();

  const data = {
    name: nameInput.value.trim(),
    phone: phoneInput.value.trim(),
    district: districtInput.value,
    office: officeInput.value.trim(),
    post: postInput.value
  };

  if(docId.value){
    await updateDoc(doc(db,"employees",docId.value), data);
  } else {
    await addDoc(collection(db,"employees"), data);
  }

  empForm.reset();
  docId.value="";
  loadData();
});

/* EXCEL */
uploadExcelBtn.onclick = async()=>{
  const file = excelFile.files[0];
  if(!file) return alert("Select file");

  const buf = await file.arrayBuffer();
  const wb = XLSX.read(buf,{type:"array"});
  const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);

  for(const r of rows){
    if(r.name && r.phone && r.district && r.post){
      await addDoc(collection(db,"employees"),{
        name:String(r.name),
        phone:String(r.phone),
        district:String(r.district),
        office:String(r.office||""),
        post:String(r.post)
      });
    }
  }
  excelFile.value="";
  loadData();
};
</script>

</body>
</html>
