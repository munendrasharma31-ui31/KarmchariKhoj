<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>à¤†à¤¨à¥à¤¤à¤°à¤¿à¤• à¤²à¥‡à¤–à¤¾ à¤à¤µà¤‚ à¤²à¥‡à¤–à¤¾ à¤ªà¤°à¥€à¤•à¥à¤·à¤¾ à¤¨à¤¿à¤¦à¥‡à¤¶à¤¾à¤²à¤¯ | Public Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></script>
</head>

<body class="bg-slate-100">

<!-- ğŸ” SESSION CHECK -->
<script>
if (sessionStorage.getItem("empAuth") !== "true") {
  location.href = "index.html";
}
</script>

<!-- HEADER -->
<header class="bg-indigo-700 text-white py-4">
  <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold">à¤†à¤¨à¥à¤¤à¤°à¤¿à¤• à¤²à¥‡à¤–à¤¾ à¤à¤µà¤‚ à¤²à¥‡à¤–à¤¾ à¤ªà¤°à¥€à¤•à¥à¤·à¤¾ à¤¨à¤¿à¤¦à¥‡à¤¶à¤¾à¤²à¤¯</h1>
      <p class="text-sm opacity-90">Employee Dashboard</p>
    </div>
    <div class="flex items-center gap-4">
      <span class="text-sm">ğŸ‘¤ <b id="userName"></b></span>
      <button onclick="logout()"
        class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-xl font-bold">
        Logout
      </button>
    </div>
  </div>
</header>

<main class="max-w-5xl mx-auto p-6 space-y-10">

<!-- ================= METHOD 1 : SEARCH BY NAME (GLOBAL) ================= -->
<section class="bg-white p-6 rounded-2xl shadow">
  <h2 class="text-lg font-bold mb-4 text-indigo-700">
    ğŸ” Search Employee by Name
  </h2>

  <div class="grid md:grid-cols-2 gap-4">
    <input id="nameInput"
      type="text"
      placeholder="Type employee name"
      class="border p-3 rounded-xl"/>
    <button id="nameSearchBtn"
      class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold">
      Search
    </button>
  </div>

  <div id="nameResult" class="hidden mt-6"></div>
</section>

<!-- ================= METHOD 2 : DROPDOWN SEARCH ================= -->
<section class="bg-white p-6 rounded-2xl shadow">
  <h2 class="text-lg font-bold mb-4 text-indigo-700">
    ğŸ“‹ Search by District / Office / Post
  </h2>

  <div class="grid md:grid-cols-5 gap-4">
    <select id="districtDrop" class="border p-3 rounded-xl">
      <option value="">Select District</option>
       <option value="Agra">Agra</option>
  <option value="Aligarh">Aligarh</option>
  <option value="Ambedkar Nagar">Ambedkar Nagar</option>
  <option value="Amethi">Amethi</option>
  <option value="Amroha">Amroha</option>
  <option value="Auraiya">Auraiya</option>
  <option value="Ayodhya">Ayodhya</option>
  <option value="Azamgarh">Azamgarh</option>
  <option value="Baghpat">Baghpat</option>
  <option value="Bahraich">Bahraich</option>
  <option value="Ballia">Ballia</option>
  <option value="Balrampur">Balrampur</option>
  <option value="Banda">Banda</option>
  <option value="Barabanki">Barabanki</option>
  <option value="Bareilly">Bareilly</option>
  <option value="Basti">Basti</option>
  <option value="Bijnor">Bijnor</option>
  <option value="Budaun">Budaun</option>
  <option value="Bulandshahr">Bulandshahr</option>
  <option value="Chandauli">Chandauli</option>
  <option value="Chitrakoot">Chitrakoot</option>
  <option value="Deoria">Deoria</option>
  <option value="Etah">Etah</option>
  <option value="Etawah">Etawah</option>
  <option value="Farrukhabad">Farrukhabad</option>
  <option value="Fatehpur">Fatehpur</option>
  <option value="Firozabad">Firozabad</option>
  <option value="Gautam Buddha Nagar">Gautam Buddha Nagar</option>
  <option value="Ghaziabad">Ghaziabad</option>
  <option value="Ghazipur">Ghazipur</option>
  <option value="Gonda">Gonda</option>
  <option value="Gorakhpur">Gorakhpur</option>
  <option value="Hamirpur">Hamirpur</option>
  <option value="Hapur">Hapur</option>
  <option value="Hardoi">Hardoi</option>
  <option value="Hathras">Hathras</option>
  <option value="Jalaun">Jalaun</option>
  <option value="Jaunpur">Jaunpur</option>
  <option value="Jhansi">Jhansi</option>
  <option value="Kannauj">Kannauj</option>
  <option value="Kanpur Dehat">Kanpur Dehat</option>
  <option value="Kanpur Nagar">Kanpur Nagar</option>
  <option value="Kasganj">Kasganj</option>
  <option value="Kaushambi">Kaushambi</option>
  <option value="Kushinagar">Kushinagar</option>
  <option value="Lakhimpur Kheri">Lakhimpur Kheri</option>
  <option value="Lalitpur">Lalitpur</option>
  <option value="Lucknow">Lucknow</option>
  <option value="Maharajganj">Maharajganj</option>
  <option value="Mahoba">Mahoba</option>
  <option value="Mainpuri">Mainpuri</option>
  <option value="Mathura">Mathura</option>
  <option value="Mau">Mau</option>
  <option value="Meerut">Meerut</option>
  <option value="Mirzapur">Mirzapur</option>
  <option value="Moradabad">Moradabad</option>
  <option value="Muzaffarnagar">Muzaffarnagar</option>
  <option value="Pilibhit">Pilibhit</option>
  <option value="Pratapgarh">Pratapgarh</option>
  <option value="Prayagraj">Prayagraj</option>
  <option value="Rae Bareli">Rae Bareli</option>
  <option value="Rampur">Rampur</option>
  <option value="Saharanpur">Saharanpur</option>
  <option value="Sambhal">Sambhal</option>
  <option value="Sant Kabir Nagar">Sant Kabir Nagar</option>
  <option value="Sant Ravidas Nagar">Sant Ravidas Nagar</option>
  <option value="Shahjahanpur">Shahjahanpur</option>
  <option value="Shamli">Shamli</option>
  <option value="Shravasti">Shravasti</option>
  <option value="Siddharthnagar">Siddharthnagar</option>
  <option value="Sitapur">Sitapur</option>
  <option value="Sonbhadra">Sonbhadra</option>
  <option value="Sultanpur">Sultanpur</option>
  <option value="Unnao">Unnao</option>
  <option value="Varanasi">Varanasi</option>

    </select>

    <select id="officeSelect" class="border p-3 rounded-xl">
      <option value="">Select Office</option>
    </select>

    <select id="postSelect" class="border p-3 rounded-xl">
      <option value="">Select Post</option>
      <option>Assistant Accountant</option>
      <option>Accountant</option>
      <option>Assistant Account Officer</option>
    </select>

    <select id="employeeSelect" class="border p-3 rounded-xl">
      <option value="">Select Employee</option>
    </select>

    <button id="searchBtn"
      class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl">
      Search
    </button>
  </div>

  <div id="dropResult" class="hidden mt-6"></div>
</section>

</main>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, query, where, doc, getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDE0Oy6bSo05jl48kugFnrtHAPZt-eanA",
  authDomain: "antrik-lekha.firebaseapp.com",
  projectId: "antrik-lekha",
  appId: "1:82198306544:web:bfb58e6c8d03f7d664ac35"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("userName").innerText =
  sessionStorage.getItem("empName") || "";

/* ================= METHOD 1 : GLOBAL NAME SEARCH ================= */
nameSearchBtn.onclick = async () => {
  const name = nameInput.value.trim().toLowerCase();
  nameResult.innerHTML = "";
  nameResult.classList.add("hidden");

  if (!name) {
    alert("Please enter employee name");
    return;
  }

  const snap = await getDocs(collection(db, "employees"));

  const emp = snap.docs
    .map(d => d.data())
    .find(e => e.name.toLowerCase().includes(name));

  if (!emp) {
    nameResult.innerHTML =
      "<p class='text-red-600 font-semibold'>No record found</p>";
  } else {
    nameResult.innerHTML = `
      <div class="bg-slate-50 p-4 rounded-xl space-y-1">
        <div class="font-bold text-lg">${emp.name}</div>
        <div>ğŸ“ ${emp.phone}</div>
        <div>ğŸ“ ${emp.district}</div>
        <div>ğŸ¢ ${emp.office}</div>
        <div>ğŸ‘” ${emp.post}</div>
      </div>`;
  }

  nameResult.classList.remove("hidden");
};

/* ================= METHOD 2 : DROPDOWN SEARCH ================= */
districtDrop.onchange = async () => {
  officeSelect.innerHTML = "<option>Select Office</option>";

  const q = query(collection(db, "employees"),
    where("district", "==", districtDrop.value));
  const snap = await getDocs(q);

  [...new Set(snap.docs.map(d => d.data().office))]
    .sort((a, b) => a.localeCompare(b))
    .forEach(o => {
      officeSelect.innerHTML += `<option>${o}</option>`;
    });
};

officeSelect.onchange = async () => {
  employeeSelect.innerHTML = "<option>Select Employee</option>";

  const q = query(collection(db, "employees"),
    where("district", "==", districtDrop.value),
    where("office", "==", officeSelect.value));
  const snap = await getDocs(q);

  snap.forEach(d => {
    const e = d.data();
    if (postSelect.value && e.post !== postSelect.value) return;
    employeeSelect.innerHTML +=
      `<option value="${d.id}">${e.name}</option>`;
  });
};

searchBtn.onclick = async () => {
  const snap = await getDoc(
    doc(db, "employees", employeeSelect.value));
  if (!snap.exists()) return;

  const e = snap.data();
  dropResult.innerHTML = `
    <div class="bg-slate-50 p-4 rounded-xl space-y-1">
      <div class="font-bold text-lg">${e.name}</div>
      <div>ğŸ“ ${e.phone}</div>
      <div>ğŸ“ ${e.district}</div>
      <div>ğŸ¢ ${e.office}</div>
      <div>ğŸ‘” ${e.post}</div>
    </div>`;
  dropResult.classList.remove("hidden");
};

window.logout = () => {
  sessionStorage.clear();
  location.href = "index.html";
};
</script>

</body>
</html>
