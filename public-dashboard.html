<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>рдЖрдиреНрддрд░рд┐рдХ рд▓реЗрдЦрд╛ рдПрд╡рдВ рд▓реЗрдЦрд╛ рдкрд░реАрдХреНрд╖рд╛ рдирд┐рджреЗрд╢рд╛рд▓рдп | Public Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></script>
</head>

<body class="bg-slate-100">

<!-- ЁЯФР SESSION CHECK -->
<script>
if (sessionStorage.getItem("empAuth") !== "true") {
  location.href = "index.html";
}
</script>

<!-- HEADER -->
<header class="bg-indigo-700 text-white py-4">
  <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold">рдЖрдиреНрддрд░рд┐рдХ рд▓реЗрдЦрд╛ рдПрд╡рдВ рд▓реЗрдЦрд╛ рдкрд░реАрдХреНрд╖рд╛ рдирд┐рджреЗрд╢рд╛рд▓рдп</h1>
      <p class="text-sm opacity-90">Employee Dashboard</p>
    </div>
    <div class="flex items-center gap-4">
      <span class="text-sm">ЁЯСд <b id="userName"></b></span>
      <button onclick="logout()"
        class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-xl font-bold">
        Logout
      </button>
    </div>
  </div>
</header>

<main class="max-w-5xl mx-auto p-6 space-y-10">

<!-- ================= METHOD 1 : SEARCH BY NAME ================= -->
<section class="bg-white p-6 rounded-2xl shadow">
  <h2 class="text-lg font-bold mb-4 text-indigo-700">
    ЁЯФН Search by Employee Name
  </h2>

  <div class="grid md:grid-cols-2 gap-4">
    <select id="districtNameSearch" class="border p-3 rounded-xl">
      <option value="">Select District</option>
      <option>Lucknow</option>
      <option>Prayagraj</option>
      <option>Varanasi</option>
      <option>Agra</option>
    </select>

    <input id="nameInput"
      type="text"
      placeholder="Type employee name"
      class="border p-3 rounded-xl"/>
  </div>

  <div class="mt-4">
    <button id="nameSearchBtn"
      class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-xl font-bold">
      Search
    </button>
  </div>

  <div id="nameResult" class="hidden mt-6"></div>
</section>

<!-- ================= METHOD 2 : DROPDOWN SEARCH ================= -->
<section class="bg-white p-6 rounded-2xl shadow">
  <h2 class="text-lg font-bold mb-4 text-indigo-700">
    ЁЯУЛ Search by District / Office / Post
  </h2>

  <div class="grid md:grid-cols-5 gap-4">
    <select id="districtDrop" class="border p-3 rounded-xl">
      <option value="">Select District</option>
      <option>Lucknow</option>
      <option>Prayagraj</option>
      <option>Varanasi</option>
      <option>Agra</option>
    </select>

    <select id="officeSelect" class="border p-3 rounded-xl">
      <option value="">Select Office</option>
    </select>

    <select id="postSelect" class="border p-3 rounded-xl">
      <option value="">Select Post</option>
      <option>Assistant Accountant</option>
      <option>Accountant</option>
      <option>Assistant Account Officer</option>
    </select>

    <select id="employeeSelect" class="border p-3 rounded-xl">
      <option value="">Select Employee</option>
    </select>

    <button id="searchBtn"
      class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl">
      Search
    </button>
  </div>

  <div id="dropResult" class="hidden mt-6"></div>
</section>

</main>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, query, where, doc, getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDE0Oy6bSo05jl48kugFnrtHAPZt-eanA",
  authDomain: "antrik-lekha.firebaseapp.com",
  projectId: "antrik-lekha",
  appId: "1:82198306544:web:bfb58e6c8d03f7d664ac35"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("userName").innerText =
  sessionStorage.getItem("empName") || "";

/* ================= METHOD 1 LOGIC ================= */
nameSearchBtn.onclick = async () => {
  const dist = districtNameSearch.value;
  const name = nameInput.value.toLowerCase();
  nameResult.innerHTML = "";
  nameResult.classList.add("hidden");

  if(!dist || !name) return alert("Select district and enter name");

  const q = query(collection(db,"employees"),
    where("district","==",dist));
  const snap = await getDocs(q);

  const emp = snap.docs
    .map(d=>d.data())
    .find(e=>e.name.toLowerCase().includes(name));

  if(!emp){
    nameResult.innerHTML="<p class='text-red-600'>No record found</p>";
  } else {
    nameResult.innerHTML = `
      <div class="bg-slate-50 p-4 rounded-xl">
        <b>${emp.name}</b><br>
        ЁЯУЮ ${emp.phone}<br>
        ЁЯПв ${emp.office}<br>
        ЁЯСФ ${emp.post}
      </div>`;
  }
  nameResult.classList.remove("hidden");
};

/* ================= METHOD 2 LOGIC ================= */
districtDrop.onchange = async () => {
  officeSelect.innerHTML="<option>Select Office</option>";
  const q=query(collection(db,"employees"),
    where("district","==",districtDrop.value));
  const snap=await getDocs(q);

  [...new Set(snap.docs.map(d=>d.data().office))]
    .sort((a,b)=>a.localeCompare(b))
    .forEach(o=>{
      officeSelect.innerHTML+=`<option>${o}</option>`;
    });
};

officeSelect.onchange = async () => {
  employeeSelect.innerHTML="<option>Select Employee</option>";
  const q=query(collection(db,"employees"),
    where("district","==",districtDrop.value),
    where("office","==",officeSelect.value));
  const snap=await getDocs(q);

  snap.forEach(d=>{
    const e=d.data();
    if(postSelect.value && e.post!==postSelect.value) return;
    employeeSelect.innerHTML+=
      `<option value="${d.id}">${e.name}</option>`;
  });
};

searchBtn.onclick = async () => {
  const snap=await getDoc(
    doc(db,"employees",employeeSelect.value));
  if(!snap.exists()) return;

  const e=snap.data();
  dropResult.innerHTML = `
    <div class="bg-slate-50 p-4 rounded-xl">
      <b>${e.name}</b><br>
      ЁЯУЮ ${e.phone}<br>
      ЁЯПв ${e.office}<br>
      ЁЯСФ ${e.post}
    </div>`;
  dropResult.classList.remove("hidden");
};

window.logout = () => {
  sessionStorage.clear();
  location.href = "index.html";
};
</script>

</body>
</html>
